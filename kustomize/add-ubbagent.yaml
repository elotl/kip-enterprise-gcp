- op: add
  path: /spec/template/spec/containers/-
  value:
    name: ubbagent
    image: elotl/ubbagent:latest
    env:
    - name: AGENT_CONFIG_FILE
      value: "/etc/ubbagent/config.yaml"
    - name: AGENT_LOCAL_PORT
      value: "4567"
    - name: AGENT_ENCODED_KEY
      valueFrom:
        secretKeyRef:
          name: $(REPORTING_SECRET)
          key: reporting-key
    - name: AGENT_CONSUMER_ID
      valueFrom:
        secretKeyRef:
          name: $(REPORTING_SECRET)
          key: consumer-id
    - name: REPORTING_SECRET
      valueFrom:
        configMapKeyRef:
          name: ubbagent-config
          key: REPORTING_SECRET
    volumeMounts:
    - name: ubbagent-config
      mountPath: /etc/ubbagent
- op: add
  path: /spec/template/spec/volumes/-
  value:
    name: ubbagent-config
    configMap:
      name: ubbagent-config
      items:
      - key: ubbagent-config.yaml
        path: config.yaml
